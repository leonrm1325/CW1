<html style="font-family: Arial, Helvetica, sans-serif;">
    <head>
        <title>After school club</title>
        <!--script loads vue.js from a server-->
        <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
        <script src="products.js"></script>
    </head>

    <body>
        <div id="app">
            <header>
                <h1 v-text="sitename"></h1>
                <button v-on:click='showCheckout'> Checkout {{basketItemCount}} </button>
            </header>
            <main>
                <div v-if='showProduct'>
                    <label for="sortSelect">Sort by:</label>
                        <select id="sortSelect" v-model="selectedSort" @change="sortProducts">
                            <option value="default">Default</option>
                            <option value="ascPrice">Price: Ascending</option>
                            <option value="descPrice">Price: Descending</option>
                            <option value="ascTitle">Title: Ascending</option>
                            <option value="descTitle">Title: Descending</option>
                        </select>
                    <!--div displays the product page -->
                    <div v-for="product in sortedProducts">
                        <!--The structure of each product-->
                        <h2 v-text="product.title"></h2>
                        <figure>
                            <img style="max-width:50px; max-height: 50px;" v-bind:src="product.image">
                        </figure>
                        <p v-text="product.description"></p>
                        <p>Location: {{product.location}}</p>
                        <p>Availability: {{product.availability}} spaces</p>
                        <p>Price: Â£ {{product.price}}</p>
                        <button v-on:click='addProduct(product)'>Add</button>
                    </div>
                </div>
                <!-- div displays checkout page with input form to store user information-->
                <div v-else>
                    <h3>CHECKOUT</h3>
                    <h4>Enter your information</h3>
                    <p>first name:</p>
                    <input v-model.trim="order.firstName">
                    <p>last name:</p>
                    <input v-model.trim="order.lastName">
                    <p>phone number:</p>
                    <input v-model="order.phoneNumber" type='number'>
                </div>
            </main>
        </div>
        <script type="text/javascript">
            //creates vue.js instance
            var webstore = new Vue({
                el: '#app', 
                data: { 
                    sitename: 'After School Club Booking System',
                    products: products,
                    basket: [],
                    showProduct: true,
                    order: {
                        firstName: '',
                        lastName: '',
                        phoneNumber:'',
                    },
                    selectedSort: 'default',
                },
                methods: {
                    addProduct: function (product) {
                        if (product.availability > 0) {
                            this.basket.push(product.id);
                            product.availability--;
                            console.log("Added product to basket:", product.id);
                        } else {
                            alert("Out of stock");
                        }
                    },
                    showCheckout() {
                        if (this.basket.length > 0) {
                            this.showProduct = !this.showProduct;
                        } else {
                            alert("Your basket is empty. Add items before proceeding to checkout.");
                        }
                    },
                    resetProducts() {
                        this.products = this.originalProducts();
                    },
                    sortByPriceAsc(products) {
                        return products.slice().sort(function (a, b) {
                            if (a.price > b.price) return 1;
                            if (a.price < b.price) return -1;
                            return 0;
                        });
                    },
                    sortByPriceDesc(products) {
                        return products.slice().sort(function (a, b) {
                            if (a.price > b.price) return -1;
                            if (a.price < b.price) return 1;
                            return 0;
                        });
                    },
                    sortByTitleAsc(products) {
                        return products.slice().sort(function (a, b) {
                            if (a.title.toLowerCase() < b.title.toLowerCase()) return 1;
                            if (a.title.toLowerCase() > b.title.toLowerCase()) return -1;
                            return 0;
                        });
                    },
                    sortByTitleDesc(products) {
                        return products.slice().sort(function (a, b) {
                            if (a.title.toLowerCase() < b.title.toLowerCase()) return -1;
                            if (a.title.toLowerCase() > b.title.toLowerCase()) return 1;
                            return 0;
                        });
                    },
                    originalProducts() {
                        return products;
                    },
                },
                computed: {
                    basketItemCount() {
                        return this.basket.length || "";
                    },
                    sortedProducts() {
                        let sorted = [];
                        if (this.selectedSort === 'ascPrice') {
                            sorted = this.sortByPriceAsc(this.products);
                        } else if (this.selectedSort === 'descPrice') {
                            sorted = this.sortByPriceDesc(this.products);
                        } else if (this.selectedSort === 'ascTitle') {
                            sorted = this.sortByTitleAsc(this.products);
                        } else if (this.selectedSort === 'descTitle') {
                            sorted = this.sortByTitleDesc(this.products);
                        } else {
                            sorted = this.originalProducts();
                        }
                        return sorted;
                    },
                }
            });
        </script>
    </body>
</html>
